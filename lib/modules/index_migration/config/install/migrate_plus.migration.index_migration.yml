id: index_migration
label: 'Index Migration'
migration_group: index_migration_group

source:
  plugin: index_sql
  key: enisa

process:
  uid:
    plugin: user_lookup
    source: email
  title: name
  field_description/value: description
  field_description/format:
    plugin: default_value
    default_value: basic_html
  field_year: year
  status:
    plugin: static_map
    source: draft
    map:
      0: 1
      1: 0
  field_json_data: json_data
  field_eu_published: eu_published
  field_ms_published: ms_published
  field_collection_started:
    plugin: format_date
    source: collection_started
    from_format: 'Y-m-d H:i:s'
    to_format: 'U'
  field_collection_deadline:
    plugin: format_date
    source: collection_deadline
    from_format: 'Y-m-d H:i:s'
    to_format: 'U'
  field_last_action:
    plugin: static_map
    source: year
    map:
      2022: ~
      2023: 'calculate_index'
      2024: 'calculate_index'
  field_last_action_state:
    plugin: index_calculation_state_lookup_by_name
    source: name
  field_last_action_date:
    plugin: index_calculation_date_lookup_by_name
    source: name
  type:
    plugin: default_value
    default_value: index

destination:
  plugin: entity:node
  default_bundle: index
  update_existing: false

migration_dependencies:
  required:
    - user_migration
