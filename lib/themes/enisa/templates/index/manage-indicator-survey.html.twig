{{ attach_library('enisa/main') }}
{{ attach_library('enisa/alert') }}
{{ attach_library('enisa/modal') }}
{{ attach_library('enisa/indicator-survey-builder') }}
{{ attach_library('enisa/survey-actions') }}

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/">Home</a></li>
      <li class="breadcrumb-item"><a href="/index/survey/configuration/management">{{ 'Index & Survey Configuration'|t }}</a></li>
      <li class="breadcrumb-item active">{{ 'Survey'|t }} {{ indicator_data.year }}</li>
  </ol>
</nav>

<h1>{{ 'Survey'|t }} {{ indicator_data.year }}</h1>

<main id="enisa-main" class="bg-white">
  <div class="container-fluid">

    {% include '@enisa/components/alert.html.twig' with {'type': 'pageAlert'} %}

    <div class="row mt-3">
      <div class="col-12 d-flex justify-content-end ps-0 pe-0">
        <div class="w-100 d-flex flex-column">
          <a id="indicatorsListDropdown" href="#" class="icon-dropdown-menu-before" role="button">{{ 'Indicators List'|t }}</a>
          <div class="dropdown-menu-wrapper indicators table-section indicator-list-toggle">
            <table id="indicators-reorder-table" class="display enisa-table-group">
              <thead>
                <tr>
                  <th>{{ 'Order'|t }}</th>
                  <th>{{ 'Name'|t }}</th>
                  <th>{{ 'Subarea'|t }}</th>
                  <th>{{ 'Validated'|t }}</th>
                </tr>
              </thead>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="row mt-2 {{ (canPreviewSurvey) ? '' : 'd-none' }}">
      <div class="col-12 d-flex justify-content-end ps-0 pe-0">
        <a href="javascript:;" class="preview-survey">{{ 'Preview Survey'|t }}</a>
      </div>
    </div>
    
    <div class="row mt-3">
      <div class="col-12 ps-0 pe-0 survey-builder-wrapper">
        <div class="row">
          <div class="col-12 survey-editor-wrapper">
            <div class="indicator-head">
              <div class="col-8">
                <h5>
                  <div>
                    <span class="form-indicator-info">{{ indicator_data.subarea.area.name|raw }} /</span>
                    <span class="form-indicator-info">{{ indicator_data.subarea.name|raw }}</span>
                  </div>
                  <div>
                    <span class="form-indicator-order" data-id="{{ indicator_data.id }}">{{ indicator_data.order }}</span>. <span class="form-indicator-name">{{ indicator_data.name|raw }}</span>
                  </div>
                </h5>
              </div>
              <div class="col-4 d-flex justify-content-end indicator-action {{ canPreviewIndicator ? '' : 'd-none' }}">
                <button type="button" class="btn btn-indicator-head preview-indicator" data-id="{{ indicator_data.id }}">{{ 'Preview Indicator'|t }}</button>
              </div>
            </div>
            <div class="indicator-body pt-2">
              <div class="col-12">
                <p class="form-indicator-text-content">{{ indicator_data.algorithm|raw }}</p>
              </div>
            </div>
            <div id="survey-editor" class="mt-3"></div>
            <div class="mt-3">
              <div class="col-12 d-flex gap-2 justify-content-end">
                <button type="button" class="btn btn-enisa-invert load-indicator-survey {{ canLoadLastIndicatorSurvey ? '' : 'disabled' }}">{{ 'Load Last Year Indicator Survey'|t }}</button>
                <button type="button" class="btn btn-enisa save">{{ 'Validate & Save'|t }}</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="printSurveyModal" class="printSurveyModalPrint" tabindex="-1" aria-labelledby="printSurveyModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header justify-content-between p-3">
            <h5 class="modal-title" id="printSurveyModalLabel"></h5>
            <div>
              <button type="button" class="btn btn-enisa" data-bs-dismiss="modal">{{ 'Close'|t }}</button>
              <button type="button" class="btn btn-enisa" onclick="saveReportPDF();" href="javascript:;">{{ 'Export | PDF'|t }}</button>
            </div>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-12 mt-2">
                <div class="row survey-print" id="surveyContainer"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="pageModal" tabindex="-1" aria-labelledby="pageModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header p-3">
            <h5 class="modal-title" id="pageModalLabel"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body p-3"></div>
          <div class="modal-footer justify-content-between">
            <button type="button" class="btn btn-enisa" data-bs-dismiss="modal">{{ 'Close'|t }}</button>
            <button type="button" class="btn btn-enisa process-data" id='process-data'></button>
          </div>
        </div>
      </div>
    </div>

  </div>
</main>
